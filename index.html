<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DENR-CENRO Diffun — Travel Order Management System</title>
  <link rel="icon" href="assets/denrlogo.png" type="image/svg+xml" />
  <style>
    :root{
      --green-900:#08331a;
      --green-700:#0b6137;
      --muted:#6b7280;
      --bg:#f7f9fb;
      --card:#ffffff;
      --glass: rgba(255,255,255,0.6);
      --radius:12px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#f7fbf7 0%, #f7f9fb 100%);color:#0f172a}

    .app{display:flex;min-height:100vh}
    .sidebar{
      width:260px;background:var(--green-900);color:white;padding:20px 16px;display:flex;flex-direction:column;gap:20px;transition:width .25s ease;
      box-shadow:0 6px 18px rgba(3,10,7,0.15)
    }
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,var(--green-700),var(--green-900));display:flex;align-items:center;justify-content:center;font-weight:700}
    .brand h1{font-size:15px;margin:0}
    .brand p{margin:0;font-size:11px;opacity:.92}

    nav{display:flex;flex-direction:column;gap:8px}
    .nav-item{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;cursor:pointer;transition:background .18s, transform .08s;user-select:none}
    .nav-item:hover{background:rgba(255,255,255,0.06);transform:translateX(4px)}
    .nav-item.active{background:linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03))}
    .nav-item svg{opacity:.95}

    .content{flex:1;padding:28px}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
    .title{font-size:18px;font-weight:700}
    .subtitle{color:var(--muted);font-size:13px}

    .card{background:var(--card);border-radius:var(--radius);padding:18px;box-shadow:0 6px 20px rgba(16,24,40,0.06);}

    form{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef3;background:transparent;font-size:14px}
    textarea{min-height:60px;resize:vertical}
    .full{grid-column:1/-1}
    .actions{display:flex;gap:10px;justify-content:center;margin-top:8px}
    button{padding:10px 14px;border-radius:10px;border:0;background:var(--green-700);color:white;font-weight:600;cursor:pointer;transition:transform .12s, box-shadow .12s}
    button.secondary{background:transparent;color:var(--green-700);border:1px solid rgba(11,97,55,0.12)}
    button:active{transform:translateY(1px)}

    table{width:100%;border-collapse:collapse;margin-top:12px}
    thead th{text-align:left;padding:12px 8px;color:var(--muted);font-size:13px;border-bottom:1px solid #eef5f7}
    tbody td{padding:12px 8px;border-bottom:1px solid #fbfcfd}

    .muted{color:var(--muted)}
    .row{display:flex;gap:12px;align-items:center}

    /* Original fade-in for page content */
    .fade-in{animation:fadeIn .28s ease both}
    @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

    @media (max-width:900px){
      .sidebar{width:68px;padding:16px}
      .brand h1,.brand p{display:none}
      form{grid-template-columns:1fr}
    }

    /* Splash Screen Styles */
    #splash-intro {
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      background:#08331a;
      color:white;
      z-index:9999;
      transition:opacity 0.5s ease-out; /* Changed from 2s to 0.5s for a smoother fade */
    }
    .splash-title-h1 {
      font-size:24px;
      margin-top:0px;
      text-align:center;
    }
    .splash-subtitle-h3 {
      font-size:18px;
    }
    /* Fade-in and slide-up animation for splash screen elements */
    @keyframes slideUpFadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
    }

    .splash-logo, .splash-title, .splash-subtitle {
        opacity: 0;
        animation: slideUpFadeIn 0.6s ease-out forwards;
    }
    .splash-title { animation-delay: 0.3s; }
    .splash-subtitle { animation-delay: 0.6s; }

    /* For the new 'Developed by' text */
    .developed-by {
      position: fixed;
      bottom: 1rem;
      right: 1rem; /* Aligned to the right */
      color: #6b7280;
      font-size: 11px;
      opacity: 0.7;
    }

    /* Spinner */
    @keyframes spin {to {transform: rotate(360deg)}}
  </style>
</head>
<body>
  <div id="splash-intro">
    <img src="assets/logo1.png" alt="DENR-CENRO Diffun Logo" class="splash-logo" style="width: 200px; height:auto; border-radius:12px;">
    <h1 class="splash-title" class="splash-title-h1">DENR-CENRO Diffun</h1>
  </div>
  <div class="app">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">DF</div>
        <div>
          <h1>DENR-CENRO Diffun</h1>
          <p style="font-weight:600">Travel Order Management System</p>
        </div>
      </div>

      <nav>
        <div class="nav-item active" data-view="form" id="nav-form">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 7h16M4 12h10M4 17h16" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <div>Encoding Form</div>
        </div>

        <div class="nav-item" data-view="list" id="nav-list">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 7h18M3 12h18M3 17h18" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <div>Encoded Travel Order List</div>
        </div>
      </nav>

      <div style="margin-top:auto;font-size:12px;opacity:.95" id="statusContainer">
        <div class="muted">Status:</div>
        <div style="margin-top:6px;font-weight:700">Checking...</div>
      </div>
    </aside>

    <main class="content">
      <div class="topbar">
        <div>
          <div class="title">Travel Order Management System</div>
          <div class="subtitle">DENR-CENRO Diffun</div>
        </div>
        <div class="row">
          <div class="muted">Quick actions</div>
          <button id="syncBtn" class="secondary">Sync List</button>
        </div>
      </div>

      <section id="view-form" class="card fade-in">
        <h3 style="margin-top:0">Encoding Form</h3>
        <form id="toForm">
          <div>
            <label for="name">Name</label>
            <select id="name" name="name" required>
              <option value="" disabled selected>Select a name</option>
            </select>
          </div>

          <div>
            <label for="position">Position</label>
            <select id="position" name="position" required>
              <option value="" disabled selected>Select a position</option>
            </select>
          </div>

          <div>
            <label for="section">Office / Section / Unit</label>
            <select id="section" name="section" required>
              <option value="">-- Select Section --</option>
              <option value="Conservation & Development Section">Conservation & Development Section</option>
              <option value="Monitoring & Enforcement Section">Monitoring & Enforcement Section</option>
              <option value="Regulation & Permitting Section">Regulation & Permitting Section</option>
              <option value="Planning & Support Unit">Planning & Support Unit</option>
              <option value="Office of the CENR Officer">Office of the CENR Officer</option>
            </select>
          </div>          

          <div class="col-md-4">
            <label for="sectionChief" class="form-label">Section Chief</label>
            <select class="form-select" id="sectionChief" name="sectionChief" required>
              <option value="" disabled selected>Select name</option>
              <option value="JENNIFER O. DAMANSE, RPF">JENNIFER O. DAMANSE, RPF</option>
              <option value="JUNE M. LAZARO, RPF">JUNE M. LAZARO, RPF</option>
              <option value="ENGR. SEBASTIAN M. MAGAT">ENGR. SEBASTIAN M. MAGAT</option>
              <option value="NONE">NONE</option>
            </select>
          </div>
          

          <div>
            <label for="departureDate">Departure Date</label>
            <input id="departureDate" name="departureDate" type="date" required />
          </div>

          <div>
            <label for="arrivalDate">Arrival Date</label>
            <input id="arrivalDate" name="arrivalDate" type="date" required />
          </div>

          <div class="full">
            <label for="destination">Destination</label>
            <textarea id="destination" name="destination" required></textarea>
          </div>

          <div class="full">
            <label for="purpose">Purpose</label>
            <textarea id="purpose" name="purpose" required></textarea>
          </div>

          <div class="actions full">
            <button type="button" id="clearBtn" class="secondary">Clear</button>
            <button type="submit" id="submitBtn">Submit Travel Order</button>
          </div>
        </form>
      </section>

      <section id="view-list" class="card" style="display:none; margin-top:18px; font-size:12px;">
        <h3 style="margin-top:0; font-size:14px;">Encoded Travel Order List</h3>
        <div id="listContainer">
          <div class="muted" style="font-size:12px;">
            No data loaded. Click <strong>Sync List</strong> or switch to this view to fetch records.
          </div>
        </div>
      </section>
      
    </main>
  </div>
  <div class="developed-by">
    Developed by <br><strong>ALDRIN N. DAMANCE, LPT <br>IT TECHNICAL SUPPORT STAFF</strong>
  </div>

<script>
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbzID3I4TqcCBfLay2jQdwoZshe41vAU42AELiesNtFjD3RisdTvC-FFgrApj-P0xRW-/exec';
  
    let allTravelOrders = [];
  
    const navItems = document.querySelectorAll('.nav-item');
    const views = {
      form: document.getElementById('view-form'),
      list: document.getElementById('view-list')
    };
  
    navItems.forEach(n => n.addEventListener('click', () => {
      navItems.forEach(x => x.classList.remove('active'));
      n.classList.add('active');
      const view = n.getAttribute('data-view');
      for (const k in views) {
        views[k].style.display = (k === view) ? 'block' : 'none';
      }
      if (view === 'list' && allTravelOrders.length === 0) {
        loadList();
      } else if (view === 'list') {
        renderTable(allTravelOrders);
      }
    }));
  
    const form = document.getElementById('toForm');
    const clearBtn = document.getElementById('clearBtn');
    const syncBtn = document.getElementById('syncBtn');
    const listContainer = document.getElementById('listContainer');
  
    clearBtn.addEventListener('click', () => form.reset());

    document.addEventListener('DOMContentLoaded', () => {
      const names = [
            "Abello, Denver John T.", "Acoba, Corazon S.", "Acosta, Mharycris G.", "Agcaoili, Jaymark R.", "Aloni, Mary H.", "Andres, Edrichein P.",
            "Ancheta, Eddie B.", "Ancheta, Vilma L.", "Arellano, Renato M.", "Bacarro, Julius Augustus B.", "Barayuga, Allan Jay D.",
            "Barrientos, Claudine M.", "Butic, Cyril D.", "Calantas, Aldrin James P.", "Concepcion, Ronnie B.",
            "Damance, Aldrin N.", "Damanse, Jennifer O.", "De Guzman, Mar B.", "De Vera, Jasmine Love N.", "Del Rosario, Gilbert D.",
            "Dellias, Jude C.", "Delos Santos, Roxann B.", "Gatin, Alvin B.", "Lazaro, June M.", "Lorete, Federico T.",
            "Mabborang, Corazon L.", "Magat, Sebastian M.", "Manglapuz, Ariel M.", "Mariñas-Gatin, Jennilyn G.", "Nahoy, Ngoy Ngoy D.",
            "Nanglihan, Romel B.", "Navarro, Alberto, Jr. P.", "Nonan, Maribel V.", "Ocampo, Florida Blanca S.", "Pagaduan, Raymark T.",
            "Pico, Susan D.", "Pulido, Ana Roberta", "Ribunal, Jaynaliza A.", "Romero, Marilou E.", "Romero, Randy C.",
            "Salvador, Dennis C.", "Santiago, Alejandro G.", "Seraspi, Jan Millius A.", "Simodio, Sonny O.", "Sojor, Marie Belle E.",
            "Soriano, Norissa Belle L.", "Viray, Rodelito B.", "Yanguas, Roque S."
        ];
  
        const positions = [
            "Administrative Aide I", "Administrative Aide VI", "Administrative Officer I", "Cartographer I", "Credit Officer", "C/Administrative Aide/Driver",
            "C/Data Management Officer", "C/Planning Support Staff", "C/Forester", "C/Forest Extension Officer", "C/Forest Protection Officer", "C/Nursery Aide",
            "C/Park Ranger", "C/Utility Worker", "C/Lams Encoder", "Ecosystems Management Specialist II", "Engineer II", "Forester I",
            "Forester II", "Forester III", "Forest Ranger", "Forest Technician I", "Forest Technician II",
            "IT Technical Support Staff", "Land Management Examiner",
            "Land Management Officer I", "Land Management Officer II", "Land Management Officer III", "Land Management Inspector", "Park Maintenance Foreman",
            "Park Ranger", "Senior Ecosystems Management Specialist", "Special Investigator I", "Special Investigator II", "Supervising Ecosystems Management Specialist"
        ];

  // Populate position select
  const positionSelect = document.getElementById('position');
  positions.forEach(pos => {
    const option = document.createElement('option');
    option.value = pos;
    option.textContent = pos;
    positionSelect.appendChild(option);
  });

  // Populate name select
  const nameSelect = document.getElementById('name');
  names.forEach(name => {
    const option = document.createElement('option');
    option.value = name;
    option.textContent = name;
    nameSelect.appendChild(option);
  });
});
    // Auto-uppercase Name
    document.querySelectorAll('input, textarea').forEach(el => {
  el.addEventListener('input', e => {
    e.target.value = e.target.value.toUpperCase();
  });
});

 ////////////////////////////////////script///////////////////////////////////

  form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const submitBtn = document.getElementById('submitBtn');
  submitBtn.disabled = true;
  submitBtn.innerHTML = '<div style="width:16px;height:16px;border:2px solid #ccc;border-top-color:white;border-radius:50%;animation:spin 0.6s linear infinite"></div>';

  const formData = new FormData(form);
  
  if (new Date(formData.get('arrivalDate')) < new Date(formData.get('departureDate'))) {
    alert('Arrival date must be after or equal to the departure date.');
    submitBtn.disabled = false;
    submitBtn.innerHTML = 'Submit Travel Order';
    return;
  }

  if (formData.get('sectionChief') === 'NONE') {
      formData.append('status', 'PLANNING-PENDING');
  }

  const formBody = new URLSearchParams(formData);
  formBody.append('action', 'submit');

  try {
    const res = await fetch(GAS_URL, { 
      method: 'POST', 
      body: formBody 
    });
    const json = await res.json();

    if (json.status === 'success') {
      alert('✅ Travel Order submitted successfully.');
      form.reset();
      
      // Refresh the list if it's currently displayed
      if (views.list.style.display !== 'none') {
        loadList();
      }

    } else {
      alert(`❌ Submission failed: ${json.message || 'Server returned an unexpected response.'}`);
    }
  } catch (err) {
    alert(`❌ Submission failed:\n${err.message}`);
  } finally {
    submitBtn.disabled = false;
    submitBtn.innerHTML = 'Submit Travel Order';
  }
});

  
  async function loadList() {
    listContainer.innerHTML = `
      <div style="display:flex;align-items:center;gap:8px;color:var(--muted)">
        <div style="width:16px;height:16px;border:2px solid #ccc;border-top-color:var(--green-700);border-radius:50%;animation:spin 0.6s linear infinite"></div>
        Loading…
      </div>`;
    
    try {
      const res = await fetch(GAS_URL);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      
      allTravelOrders = await res.json();
      
      if (!Array.isArray(allTravelOrders)) {
        throw new Error("Invalid JSON format");
      }
      
      renderTable(allTravelOrders);
      
    } catch (err) {
      console.error("Error loading list:", err);
      listContainer.innerHTML = '<div class="text-muted">Failed to fetch list.</div>';
    }
  }

function esc(text) {
  return String(text || '').replace(/[&<>"']/g, m => ({
    '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
  }[m]));
}

function getVal(row, keys) {
  for (let k of keys) {
    let v = row[k] 
            ?? row[k.toLowerCase()] 
            ?? row[k.replace(/\s+/g, '')] 
            ?? '';
    if (v) return v;
  }
  return '';
}

function formatDateTime(d) {
  if (!d) return '';
  const date = new Date(d);
  return isNaN(date) ? d : date.toLocaleDateString('en-US', {
    month: 'short',
    day: 'numeric',
    year: 'numeric'
  });
}


function formatDateTimeReadable(dateString) {
  if (!dateString) return '-';
  const date = new Date(dateString);
  if (isNaN(date)) return '-';
  return date.toLocaleString('en-US', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: 'numeric',
    minute: '2-digit',
    hour12: true
  });
}


function renderTable(rows, page = 1, searchTerm = '', sectionFilter = '', statusFilter = '') {
  const rowsPerPage = 10;
  listContainer.innerHTML = ''; 

  const uniqueSections = [...new Set(rows.map(r => getVal(r, ['Section', 'section'])).filter(Boolean))];
  const uniqueStatuses = ['All Statuses','Pending', 'CENRO-APPROVED', 'CENRO-DISAPPROVED',  'PLANNING-PENDING', 'PLANNING-APPROVED', 'PLANNING-DISAPPROVED', 'SC-Approved', 'SC-Disapproved'];
  
  const filterDiv = document.createElement('div');
  filterDiv.className = 'row g-3 mb-2';

  const searchInput = document.createElement('input');
  searchInput.type = 'text';
  searchInput.className = 'form-control form-control-sm';
  searchInput.placeholder = 'Search...';
  searchInput.value = searchTerm;
  searchInput.style.cssText = 'flex: 1;';
  
  let searchTimeout;
  searchInput.addEventListener('input', () => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
        renderTable(allTravelOrders, 1, searchInput.value, sectionSelect.value, statusSelect.value);
    }, 1200);
  });
  
  const sectionSelect = document.createElement('select');
  sectionSelect.className = 'form-select form-select-sm';
  sectionSelect.style.cssText = 'flex: 1;';
  const defaultSectionOption = document.createElement('option');
  defaultSectionOption.value = '';
  defaultSectionOption.textContent = 'All Sections';
  sectionSelect.appendChild(defaultSectionOption);
  
  uniqueSections.forEach(sec => {
    const opt = document.createElement('option');
    opt.value = sec;
    opt.textContent = sec;
    sectionSelect.appendChild(opt);
  });
  
  sectionSelect.value = sectionFilter;
  
  sectionSelect.addEventListener('change', () => {
    renderTable(allTravelOrders, 1, searchInput.value, sectionSelect.value, statusSelect.value);
  });
  
  const statusSelect = document.createElement('select');
  statusSelect.className = 'form-select form-select-sm';
  statusSelect.style.cssText = 'flex: 1;';
  uniqueStatuses.forEach(stat => {
    const opt = document.createElement('option');
    opt.value = stat === 'All Statuses' ? '' : stat;
    opt.textContent = stat;
    statusSelect.appendChild(opt);
  });
  statusSelect.value = statusFilter;
  statusSelect.addEventListener('change', () => {
    renderTable(allTravelOrders, 1, searchInput.value, sectionSelect.value, statusSelect.value);
  });
  
  filterDiv.appendChild(searchInput);
  filterDiv.appendChild(sectionSelect);
  filterDiv.appendChild(statusSelect);
  listContainer.appendChild(filterDiv);
  
  const filteredRows = rows.filter(r => {
    const section = getVal(r, ['Section', 'section']);
    const status = (getVal(r, ['status']) || 'Pending');
    const matchesSection = sectionFilter ? section === sectionFilter : true;
    const matchesStatus = statusFilter ? status === statusFilter : true;
    
    const name = getVal(r, ['Name', 'name']).toLowerCase();
    const position = getVal(r, ['Position', 'position']).toLowerCase();
    const purpose = getVal(r, ['Purpose', 'purpose']).toLowerCase();
    const destination = getVal(r, ['Destination', 'destination']).toLowerCase();

    const term = searchTerm.toLowerCase();
    const matchesSearch = name.includes(term) || position.includes(term) || purpose.includes(term) || destination.includes(term);
    
    return matchesSearch && matchesSection && matchesStatus;
  });
  
  if (filteredRows.length === 0) {
    const noResultsDiv = document.createElement('div');
    noResultsDiv.className = 'muted';
    noResultsDiv.textContent = 'No travel orders found matching your criteria.';
    noResultsDiv.style.fontSize = '12px';
    listContainer.appendChild(noResultsDiv);
    return;
  }
  
  const start = (page - 1) * rowsPerPage;
  const paginatedRows = filteredRows.slice(start, start + rowsPerPage);
  
  const table = document.createElement('table');
  table.className = 'table table-striped table-bordered table-hover table-sm';
  table.style.fontSize = '12px';
  
  const thead = document.createElement('thead');
  const trh = document.createElement('tr');
  ['Name', 'Position', 'Section', 'Departure Date', 'Arrival Date', 'Purpose', 'Destination', 'Status'].forEach(h => {
    const th = document.createElement('th');
    th.textContent = h;
    trh.appendChild(th);
  });
  thead.appendChild(trh);
  table.appendChild(thead);
  
  const tbody = document.createElement('tbody');
  paginatedRows.forEach(r => {
    const tr = document.createElement('tr');
    const name = getVal(r, ['Name', 'name']);
    const position = getVal(r, ['Position', 'position']);
    const section = getVal(r, ['Section', 'section']);
    const departure = getVal(r, ['Departure Date', 'departureDate']);
    const arrival = getVal(r, ['Arrival Date', 'arrivalDate']);
    const purpose = getVal(r, ['Purpose', 'purpose']);
    const destination = getVal(r, ['Destination', 'destination']);
    const status = getVal(r, ['status']);
  
    [
      name,
      position,
      section,
      formatDateTime(departure),
      formatDateTime(arrival),
      purpose,
      destination,
      status
    ].forEach((cellText, index) => {
      const td = document.createElement('td');
      if (index === 5 || index === 6) {
        td.title = cellText || '';
        let displayText = (cellText && cellText.length > 10) ? cellText.substring(0, 10) + '…' : (cellText || '-');
        td.textContent = displayText;
      } else if (index === 2) {
        td.textContent = cellText || '-';
      } else if (index === 7) {
        td.textContent = cellText || 'Pending';
        td.style.fontWeight = 'bold';
        td.style.textAlign = 'center';
        td.style.color = '#fff';
        td.style.borderRadius = '6px';
        td.style.padding = '4px 8px';
        
        const statusValue = (cellText || 'Pending').toLowerCase();

if (statusValue.includes('cenro-approved')) {
    td.style.backgroundColor = '#00235d'; // Blue for CENRO-APPROVED
} else if (statusValue.includes('cenro-disapproved')) {
    td.style.backgroundColor = '#dc2626'; // Red for CENRO-DISAPPROVED
} else if (statusValue.includes('sc-approved')) {
    td.style.backgroundColor = '#16a34a'; // Green for SC-Approved
} else if (statusValue.includes('sc-disapproved')) {
    td.style.backgroundColor = '#dc2626'; // Red for SC-Disapproved
} else if (statusValue.includes('planning-disapproved')) {
    td.style.backgroundColor = '#dc2626'; // Red for planning-Disapproved
} else if (statusValue.includes('approved')) {
    td.style.backgroundColor = '#16a34a'; // Green for PLANNING-APPROVED
} else if (statusValue.includes('disapproved')) {
    td.style.backgroundColor = '#dc2626'; // Red for PLANNING-DISAPPROVED
} else {
    td.style.backgroundColor = '#fbbf24'; // Yellow for all pending statuses
}
      } else {
        td.textContent = esc(cellText) || '-';
      }
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
  
  table.appendChild(tbody);
  listContainer.appendChild(table);
  
  const totalPages = Math.ceil(filteredRows.length / rowsPerPage);
  const paginationDiv = document.createElement('div');
  paginationDiv.className = 'mt-2';
  for (let i = 1; i <= totalPages; i++) {
    const btn = document.createElement('button');
    btn.className = `btn btn-sm ${i === page ? 'btn-primary' : 'btn-outline-primary'} me-1`;
    btn.textContent = i;
    btn.addEventListener('click', () => {
      renderTable(allTravelOrders, i, searchInput.value, sectionSelect.value, statusSelect.value);
    });
    paginationDiv.appendChild(btn);
  }
  listContainer.appendChild(paginationDiv);
}

syncBtn.addEventListener('click', () => {
  document.getElementById('nav-list').click();
  loadList();
});

async function checkConnection() {
  const statusEl = document.getElementById('statusContainer');
  try {
    const res = await fetch(GAS_URL);
    if (res.ok) {
      statusEl.innerHTML = `<div class="muted">Status:</div>
        <div style="margin-top:6px;font-weight:700;color:#22c55e">Connected</div>`;
    } else {
      throw new Error();
    }
  } catch {
    statusEl.innerHTML = `<div class="muted">Status:</div>
      <div style="margin-top:6px;font-weight:700;color:#ef4444">Not Connected</div>`;
  }
}
checkConnection();

window.addEventListener('load', () => {
  document.querySelectorAll('.card').forEach((c, i) => {
    c.style.animationDelay = (i * 40) + 'ms';
  });
});

document.addEventListener('DOMContentLoaded', () => {
  const splash = document.getElementById('splash-intro');
  setTimeout(() => {
    splash.style.opacity = '0';
    setTimeout(() => splash.style.display = 'none', 500);
  }, 1500);
});
</script>
</body>
</html>